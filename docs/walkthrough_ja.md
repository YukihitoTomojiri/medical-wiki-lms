# ハイブリッド・ユーザーオンボーディング機能 ウォークスルー

本機能は、ITリテラシーの異なる様々な職員がスムーズにシステム利用を開始できるよう、「招待リンク」と「仮パスワード」の2つのオンボーディング方式を提供するものです。

## 1. ユーザー登録（管理者フロー）

`Developer Dashboard` のユーザー登録画面から職員を登録します。
- 以前のような「パスワード入力欄」は削除されています。
- ID、名前、所属、役割のみを入力し `REGISTER` ボタンを押します。

## 2. オンボーディング方式の選択

登録が完了すると、自動的にモーダルが表示され、以下の2つのタブから方式を選択できます。

### A. 招待リンク (INVITE LINK)
**対象**: 自身のスマホやPCでメール/チャットを受け取れる職員

1. **URLのコピー**: 表示された招待URLをコピーします。
2. **共有**: LINE WORKS、メール、チャットなどで該当職員にURLを送付します。
3. **ユーザー体験**:
   - 職員がURLにアクセスすると「アカウントセットアップ画面」が表示されます。
   - 自身のパスワードを設定し `ACTIVATE ACCOUNT` を押すと、即座にログインして利用を開始できます。

### B. 仮パスワード (TEMP PASSWORD)
**対象**: IT操作に不慣れで、対面でのサポートが必要な職員

1. **パスワード発行**: `ISSUE PASSWORD` ボタンを押すと、ランダムな仮パスワード（8文字）が生成されます。
2. **共有**: 口頭またはメモで職員に仮パスワードを伝えます。
3. **ユーザー体験**:
   - 職員はログイン画面から、IDと仮パスワードを入力してログインします。
   - ログイン直後に「パスワード変更画面」へ強制的にリダイレクトされます。
   - 新しいパスワードを設定することで、初めてホーム画面へアクセスできます。

## 3. セキュリティ仕様

- **招待トークン**: 招待リンクに含まれるトークンは、一度アカウント設定に使用されると無効化されます。
- **変更強制フラグ**: 仮パスワード発行時および招待作成時、ユーザーには `mustChangePassword` フラグが立ちます。
  - 招待フロー: 自身のパスワード設定時にフラグが解除されます。
  - 仮パスワードフロー: 初回変更時にフラグが解除されます。
- **未変更時の制限**: フラグが立っている間、ユーザーは `/change-password` 以外のページ（マニュアル一覧など）にはアクセスできず、常に変更画面へ転送されます（ログアウトは可能）。

---
この機能により、現場の状況に合わせた柔軟なアカウント配布が可能となり、管理者・ユーザー双方の負担を軽減します。

## 4. パスワードリカバリー（セルフサービス）

ログイン画面の「パスワードを忘れた方はこちら」リンクから、メールによるパスワードリセットが可能です。
1. **メールアドレス入力**: 登録済みのメールアドレスを入力し、リクエストを送信します。
2. **リセットリンク受信**: メール（モック環境ではコンソールログ）にパスワードリセット用のURLが届きます。
3. **パスワード再設定**: URLにアクセスし、新しいパスワードを設定します。

## 5. 管理機能の強化

`Developer Dashboard` のユーザー管理機能が強化されました。

- **メールアドレス管理**: ユーザー登録時および編集時に、メールアドレスの登録・変更が可能です。
- **管理者リセット**: ユーザー一覧の `RESET` ボタンから、強制的に仮パスワードを発行できます。
  - ボタンを押すと、ランダムな仮パスワードが発行・表示されます。
  - ユーザーは仮パスワードでログイン後、直ちにパスワード変更を求められます。

## 6. 管理者ダッシュボードの強化 (v2.0)

業務効率化のため、管理者ダッシュボードに以下のアクション機能が追加されました。

### A. 進捗遅延対策
- **Lagging Manuals Widget**: ダッシュボード上部に「進捗遅延マニュアル TOP3」が表示されます。全社的に完了率が低いマニュアルを一目で把握できます。

### B. 学習督促 (Remind)
- 職員リストの進捗バーの横に「督促 (Remind)」ボタンが追加されました。
- 未完了の職員に対して、ボタンひとつで督促通知（現在はモック実装としてアラート表示ログ記録）を送信できます。

### C. フィルタ付きCSVエクスポート
- ダッシュボード上の検索条件（施設、部署）で絞り込んだ状態で「CSV出力」ボタンを押すと、表示中の職員データのみを対象とした進捗レポートを即座にダウンロードできます。

## 7. 労務管理と開発者権限の拡張

### A. 有給休暇申請（職員向け）
1. サイドメニューまたはトップページの「**Myダッシュボード**」を開きます。
2. 「有給休暇管理」タブを選択します。
3. 開始日・終了日と理由を入力し、「申請する」ボタンを押します。
4. 申請履歴エリアに即座に反映され、ステータス（申請中）が確認できます。

### B. 承認業務（管理者・開発者向け）
1. 管理者ダッシュボードのタブから「**労務管理**」を選択します。
2. 未承認の申請一覧が表示されます。「承認」または「却下」ボタンで判定を行います。
3. 判定結果は即座に職員側の画面にも反映（APPROVED / REJECTED）されます。

### C. 開発者プロキシモード
- `DEVELOPER` 権限を持つユーザーは、管理者ダッシュボードを含む全機能にアクセス可能です。
- 管理エリアにアクセス中は、ヘッダーに**「開発者権限で代行中」**というオレンジ色のバッジが点滅表示され、特権モードであることを明確に示します。
