# ハイブリッド・ユーザーオンボーディング機能 ウォークスルー

本機能は、ITリテラシーの異なる様々な職員がスムーズにシステム利用を開始できるよう、「招待リンク」と「仮パスワード」の2つのオンボーディング方式を提供するものです。

## 1. ユーザー登録（管理者フロー）

`Developer Dashboard` のユーザー登録画面から職員を登録します。
- 以前のような「パスワード入力欄」は削除されています。
- ID、名前、所属、役割のみを入力し `REGISTER` ボタンを押します。

## 2. オンボーディング方式の選択

登録が完了すると、自動的にモーダルが表示され、以下の2つのタブから方式を選択できます。

### A. 招待リンク (INVITE LINK)
**対象**: 自身のスマホやPCでメール/チャットを受け取れる職員

1. **URLのコピー**: 表示された招待URLをコピーします。
2. **共有**: LINE WORKS、メール、チャットなどで該当職員にURLを送付します。
3. **ユーザー体験**:
   - 職員がURLにアクセスすると「アカウントセットアップ画面」が表示されます。
   - 自身のパスワードを設定し `ACTIVATE ACCOUNT` を押すと、即座にログインして利用を開始できます。

### B. 仮パスワード (TEMP PASSWORD)
**対象**: IT操作に不慣れで、対面でのサポートが必要な職員

1. **パスワード発行**: `ISSUE PASSWORD` ボタンを押すと、ランダムな仮パスワード（8文字）が生成されます。
2. **共有**: 口頭またはメモで職員に仮パスワードを伝えます。
3. **ユーザー体験**:
   - 職員はログイン画面から、IDと仮パスワードを入力してログインします。
   - ログイン直後に「パスワード変更画面」へ強制的にリダイレクトされます。
   - 新しいパスワードを設定することで、初めてホーム画面へアクセスできます。

## 3. セキュリティ仕様

- **招待トークン**: 招待リンクに含まれるトークンは、一度アカウント設定に使用されると無効化されます。
- **変更強制フラグ**: 仮パスワード発行時および招待作成時、ユーザーには `mustChangePassword` フラグが立ちます。
  - 招待フロー: 自身のパスワード設定時にフラグが解除されます。
  - 仮パスワードフロー: 初回変更時にフラグが解除されます。
- **未変更時の制限**: フラグが立っている間、ユーザーは `/change-password` 以外のページ（マニュアル一覧など）にはアクセスできず、常に変更画面へ転送されます（ログアウトは可能）。

---
この機能により、現場の状況に合わせた柔軟なアカウント配布が可能となり、管理者・ユーザー双方の負担を軽減します。
