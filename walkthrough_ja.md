# README 可視化とセクション整理

## 1. 概要
`README.md` の文字数増加に伴う可読性低下を解消するため、Mermaid.js による図解の導入、目次（Table of Contents）の追加、および情報の構造化を行いました。

## 2. 変更内容

### 🏗️ システム全体像の図解
あさひ医療グループの4施設とデータベース、およびロールごとのアクセス範囲を視覚化しました。

```mermaid
graph TD
    DB[(中央DB<br>MySQL 8.0)]
    
    subgraph Facilities [あさひ医療グループ]
        H[本館]
        S[南棟]
        HI[ひまわりの里]
        A[あおぞら中央]
    end
    
    H --- DB
    S --- DB
    HI --- DB
    A --- DB
    
    subgraph Roles [アクセス権限]
        DEV[DEVELOPER<br>全権限]
        ADM[ADMIN<br>管理施設のみ]
        USR[USER<br>本人分のみ]
    end
    
    DEV -.-> DB
    ADM -.-> Facilities
    USR -.-> H
```

### 🔄 申請フローの可視化
有給休暇・勤怠申請の流れ（申請→自動チェック→保存→承認）をシーケンス図で表現しました。

### 3. UI/UXデザインの刷新 (Material Design 3 - 2026/02/10)

### 概要
ユーザー体験を向上させるため、GoogleのMaterial Design 3 (M3) ガイドラインに基づいた大規模なUI刷新を行いました。

### 主な変更点
1. **デザインシステムの統一**
   - **カラー**: 医療機関向けに信頼感のあるティール（Teal #006A6A）をプライマリカラーとして採用。
   - **タイポグラフィ**: `Noto Sans JP` を採用し、可読性を向上。
   - **シェイプ**: 丸みを帯びた角（Radius 12px~28px）で親しみやすさを表現。

2. **コンポーネント化**
   - `src/components/ui/` にM3準拠の汎用コンポーネント（Button, Card, Input, Data Tableなど）を整備。
   - これにより、一貫したデザインと保守性の向上を実現。

3. **主要画面のリファクタリング**
   - **AdminUserManagement.tsx**: データテーブル、検索バー、モーダルをM3スタイルに刷新。
   - **DeveloperDashboard.tsx**: ステータスカード、監査ログ、システムコンソールをM3スタイルに刷新。Bottom Sheet風のコンソールを実装。
   - **OrganizationManagement.tsx**: 組織ツリーと詳細カードを一体化したデザインに変更。

### 検証結果
- すべての主要な管理画面でM3デザインが適用され、レスポンシブ動作も正常であることを確認しました。
- ダークモード（システムコンソール）とライトモード（メインコンテンツ）の調和を確認しました。
### 📑 目次とセクション整理
- **冒頭目次**: アンカーリンク付きの目次を追加し、各機能へ即座にアクセス可能にしました。
- **更新履歴の整理**: 「最近のアップデート」を折りたたみ (`<details>`) ブロックに格納し、初めて見る人には全体概要が、更新情報を知りたい人には詳細が見えるように整理しました。

## 3. データ整合性対応 (2026-02-08)

### 🧹 重複データのクリーンアップ
実装前のテストで発生したユーザー (honkan001) の申請重複（2026-02-07）を解消しました。
- **DB対応**: マイグレーションスクリプトにより、重複データを論理削除し、有効な1件（承認済みデータ）のみを残しました。
- **UI対応**: Myダッシュボードにユニークフィルタを導入し、万が一重複が存在しても画面上は正常に表示されるよう堅牢化しました。

## 4. UI/UX の高密度化・最適化 (2026-02-08)

### 📐 High Density Layout (Myダッシュボード)
13インチPC等の小型画面において一覧性が低下する問題を解消するため、UIを高密度化しました。
- **2カラムレイアウト化**: 「開始日/終了日」や「申請種別/取得単位」を横並びに配置し、縦方向のスペースを圧縮。
- **余白の削減**: `padding` や `margin` を最小限に抑え、1画面に表示できる情報量を増加。
- **スクロール領域の固定**: 申請履歴リストに `max-h-[600px]` を設定し、リストが増えても申請フォームが常に画面内に収まるよう改善。


## 5. Material Design 3 (M3) 完全準拠 (2026-02-11)

### 🎨 デザイン刷新のポイント
ビルド不整合を解消し、M3ガイドラインに準拠したデザインシステムを完全に適用しました。

#### 1. エレベーションとサーフェス
影（Shadow）による階層表現を廃止し、**Surface Colors（表面色）の濃淡** で階層を表現する方式に統一しました。
- **Base**: `m3-background` (#FBFCFD)
- **Level 1 (Card)**: `m3-surface-container-low` (#F6FBF9)
- **Level 2 (Active Item)**: `m3-secondary-container` (#CCE8E7)

#### 2. シェイプ（形状）
角丸の半径を拡大し、親しみやすさとモダンさを向上させました。
- **Card**: `rounded-xl` (28px相当の大きな角丸を適用していましたが、コンテンツの収まりを考慮し `rounded-xl` (12px-16px) を採用)
- **Button**: 完全な `rounded-full` (Pill Shape) を採用。
- **Navigation**: サイドバーの項目選択状態を、従来の「背景色塗りつぶし」から「**Pill Shape Indicator**」に変更しました。

#### 3. タイポグラフィと視認性
- **Font**: `Noto Sans JP` を優先適用。
- **Readability**: 行間を `leading-relaxed` に設定し、長文マニュアルの可読性を向上。
- **Icons**: Lucide React アイコンの線幅を調整し、アクティブ時は太く (`strokeWidth={2.5}`)、非アクティブ時は細く (`strokeWidth={2}`) して状態を明確化。

#### 4. 技術的な改善 (Build Fix)
- `tailwind.config.js` のカラー定義が正しくビルドに反映されない問題を、`index.css` の `@layer base` 定義を修正することで解決しました。
- `PostCSS` の処理順序による `@apply` のエラーを解消し、安定したビルド環境を構築しました。
- `tailwind.config.js` と `postcss.config.js` をプロジェクトルートに正しく再配置し、Viteが設定を確実に認識するようにしました。

## 6. 管理者機能の復旧とRBACの強化 (2026-02-11)

### 🔧 修正の背景
管理者（ADMIN）および開発者（DEVELOPER）権限を持つユーザーでログインした際、サイドバーに管理者用メニューが表示されない不具合が発生していました。
これは、認証情報の参照先がコンポーネント間で不統一（`props` 経由 vs `localStorage` 直接参照）であり、かつ `localStorage` のキー名が不一致だったことが原因でした。

### 🛠️ 実施した対策

#### 1. AuthContext の導入による「Single Source of Truth」
- **変更前**: `App.tsx` で状態管理し、各コンポーネントへ `props` バケツリレー、または `Sidebar.tsx` が独自に `localStorage` を参照。
- **変更後**: `AuthContext.tsx` を新規作成し、アプリケーション全体でユーザー情報と認証状態を一元管理。`useAuth` フックを通じてどこからでも安全にユーザー情報へアクセス可能にしました。

#### 2. ロールベースアクセス制御 (RBAC) の厳格化
- `useAuth` フック内に `isAdmin`, `isDeveloper` ヘルパープロパティを実装。
- `Sidebar.tsx` および `AppRoutes` (ルーティング定義) でこれらのフラグを使用し、権限のないユーザーによるアクセスをUI/ルーティング両面で遮断しました。

#### 3. レイアウトとナビゲーションの最適化
- `Layout.tsx` と `Sidebar.tsx` の結合度を下げ、`onLogout` などのイベントハンドリングを整理。
- モバイル表示時、メニュー項目をクリックした際にドロワーが自動で閉じるよう `NavigationDrawer` に `onItemClick` プロップを追加し、ユーザビリティを向上させました。

## 7. ヒーローヘッダー (Warm Orange UI) の導入 (2026-02-11)

### 🎨 コンセプトの転換
従来の「機能的だが冷たい」UIから、医療・介護現場のスタッフに安心感を与える「温かみのある」UIへの改善を行いました。

### 🛠️ 主な変更点
#### 1. ヒーローヘッダーの導入
- 各ページの上部に、M3スタイルの `Secondary Container`（薄いオレンジ）を基調とした帯状のヘッダーを配置しました。
- `rounded-[28px]` の大きな角丸と、ソフトなシャドウを採用し、親しみやすさを表現しています。

#### 2. カラーパレットの拡張
- `tailwind.config.js` に `m3-orange-*` シリーズを追加し、以下のカラーを定義しました。
  - **Primary**: `#FF9800` (Warm Orange)
  - **Secondary Container**: `#FFDDB3` (背景色)
  - **Tertiary**: `#4D6544` (アクセント)

#### 3. 視覚的効果
- ヘッダー背景にぼかし効果（`blur-2xl`）を効かせた円形の装飾要素を配置し、奥行きと柔らかさを演出しました。

## 8. 確認方法
管理者アカウント（例: `admin` / `admin123`）でログインし、マニュアル一覧ページなどのヘッダーがオレンジ色の温かみのあるデザインに変更されていることを確認してください。
また、サイドバーメニューの表示制御（RBAC）が維持されていることも併せて確認してください。


